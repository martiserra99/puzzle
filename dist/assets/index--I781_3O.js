(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const v=window.devicePixelRatio||1;class U{constructor(e){this.started=!1,this.animationId=null,this.mouseSignals=[],this.keySignals=[],this.element=null,this.setCanvas(e),this.setCanvasSize(),this.setCanvasSizeOnResize()}setCanvas(e){this.canvas=typeof e=="string"?document.querySelector(e):e,this.ctx=this.canvas.getContext("2d")}setCanvasSize(){const{width:e,height:t}=this.canvas.getBoundingClientRect();this.width=e,this.height=t,this.canvas.width=e*v,this.canvas.height=t*v,this.ctx.scale(v,v)}setCanvasSizeOnResize(){this.resizeListener=this.setCanvasSize.bind(this),window.addEventListener("resize",this.resizeListener)}start(e){this.started&&this.end(),this.insertElement(e),this.startAnimation(),this.setupSignals(),this.started=!0}insertElement(e){e.insertToUI(this)}startAnimation(){const e=()=>{this.animationId=requestAnimationFrame(e),this.updateUI()};e()}updateUI(){this.clearCanvas(),this.element.start(),this.element.measure(this.getMaxSize()),this.element.locate(this.getCoords()),this.element.draw(this.ctx),this.element.end()}getMaxSize(){return{width:this.width,height:this.height}}getCoords(){return{x:0,y:0}}setupSignals(){this.setupMouseSignals(),this.setupKeySignals()}setupMouseSignals(){const e=this.getMouseSignalTypes();for(const t of e){const n=s=>{const o=this.getMouseSignalData(s);this.element.signal({type:t,data:o})};this.mouseSignals.push({type:t,callback:n}),this.canvas.addEventListener(t,n)}}getMouseSignalTypes(){return["mousedown","mouseup","mousemove","mouseenter","mouseleave"]}getMouseSignalData(e){return{x:e.offsetX,y:e.offsetY}}setupKeySignals(){const e=this.getKeySignalTypes();for(const t of e){const n=s=>{if(s.repeat)return;const o=this.getKeySignalData(s);this.element.signal({type:t,data:o})};this.keySignals.push({type:t,callback:n}),window.addEventListener(t,n)}}getKeySignalTypes(){return["keydown","keyup"]}getKeySignalData(e){return e.key}end(){this.started&&(this.removeSignals(),this.stopAnimation(),this.removeElement(),this.started=!1)}removeSignals(){this.removeMouseSignals(),this.removeKeySignals()}removeMouseSignals(){for(const{type:e,callback:t}of this.mouseSignals)this.canvas.removeEventListener(e,t);this.mouseSignals=[]}removeKeySignals(){for(const{type:e,callback:t}of this.keySignals)window.removeEventListener(e,t);this.keySignals=[]}stopAnimation(){cancelAnimationFrame(this.animationId),this.animationId=null,this.clearCanvas()}removeElement(){this.element=null}clearCanvas(){const e=this.getCoords(),t=this.getMaxSize();this.ctx.clearRect(e.x,e.y,t.width,t.height)}}let N=class{constructor(){this.events=new Map,this.add()}[Symbol.iterator](){return this.events[Symbol.iterator]()}set(i,e){this.events.set(i,{check:e,callbacks:[]})}get(i){return this.events.get(i)}add(){this.click(),this.mousedown(),this.mouseup(),this.mouseenter(),this.mouseleave(),this.mousemove(),this.keydown(),this.keyup()}click(){this.set("click",(function(i,e,t){if(e.type!=="mousedown"&&e.type!=="mouseup")return{event:!1};const n=x(e.data,i);if(e.type==="mousedown")return t.set("wasMouseDown",n),{event:!1};const s=t.get("wasMouseDown",!1);return{event:n&&s,data:e.data}}))}mousedown(){this.set("mousedown",(function(i,e){return e.type!=="mousedown"?{event:!1}:x(e.data,i)?{event:!0,data:e.data}:{event:!1}}))}mouseup(){this.set("mouseup",(function(i,e){return e.type!=="mouseup"?{event:!1}:x(e.data,i)?{event:!0,data:e.data}:{event:!1}}))}mouseenter(){this.set("mouseenter",(function(i,e,t){if(e.type==="mouseleave"&&t.set("wasOut",!0),e.type!=="mousemove")return{event:!1};const n=x(e.data,i),s=t.get("wasOut",!0),o=n&&s;return t.set("wasOut",!n),{event:o,data:e.data}}))}mouseleave(){this.set("mouseleave",(function(i,e,t){if(e.type==="mouseleave")return t.set("wasIn",!1),{event:!0,data:e.data};if(e.type!=="mousemove")return{event:!1};const n=!x(e.data,i),s=t.get("wasIn",!1),o=n&&s;return t.set("wasIn",!n),{event:o,data:e.data}}))}mousemove(){this.set("mousemove",(function(i,e){return e.type!=="mousemove"?{event:!1}:x(e.data,i)?{event:!0,data:e.data}:{event:!1}}))}keydown(){this.set("keydown",(function(i,e){return e.type!=="keydown"?{event:!1}:{event:!0,data:e.data}}))}keyup(){this.set("keyup",(function(i,e){return e.type!=="keyup"?{event:!1}:{event:!0,data:e.data}}))}};function x(i,e){return i.x>=e.coords.x&&i.y>=e.coords.y&&i.x<=e.coords.x+e.size.width&&i.y<=e.coords.y+e.size.height}let V=class{constructor(){this.properties=new Map,this.functions=new Map}set(i,e){this.properties.set(i,e)}get(i){return this.properties.get(i)}fun(i,e){this.functions.set(i,e)}call(i,...e){return this.functions.get(i)(...e)}};class E{constructor(e){this.name=e,this.properties=new Map,this.functions=new Map,this.lifecycle=this.getLifecycle(),this.inner=new V,this.events=new N}getLifecycle(){return new S}set(e,t){this.properties.set(e,t)}fun(e,t){this.functions.set(e,t)}}class S{constructor(){this.lifecycle=new Map,this.setFunctions()}setFunctions(){this.lifecycle.set("onCreate",(()=>{})),this.lifecycle.set("onStart",(()=>{})),this.lifecycle.set("onMeasure",(()=>{})),this.lifecycle.set("onLocate",(()=>{})),this.lifecycle.set("onDraw",(()=>{})),this.lifecycle.set("onEnd",(()=>{}))}[Symbol.iterator](){return this.lifecycle[Symbol.iterator]()}set(e,t){this.lifecycle.has(e)&&this.lifecycle.set(e,t)}}class W extends E{getLifecycle(){return new G}}class G extends S{setFunctions(){super.setFunctions(),this.lifecycle.set("getSize",(()=>({width:0,height:0}))),this.lifecycle.set("drawItself",(()=>{}))}}class H extends E{constructor(e){super(e),this.layoutParams=new X}getLifecycle(){return new $}}class $ extends S{setFunctions(){super.setFunctions(),this.lifecycle.set("sortChildrenToMeasure",(e=>e.children)),this.lifecycle.set("getChildMaxSize",(()=>({width:0,height:0}))),this.lifecycle.set("getSize",(()=>({width:0,height:0}))),this.lifecycle.set("sortChildrenToLocate",(e=>e.children)),this.lifecycle.set("getChildCoords",((e,t)=>t)),this.lifecycle.set("drawItself",(()=>{})),this.lifecycle.set("sortChildrenToDraw",(e=>e.children))}}let X=class{constructor(){this.layoutParams=new Map}[Symbol.iterator](){return this.layoutParams[Symbol.iterator]()}set(i,e){this.layoutParams.set(i,e)}};class O extends E{getLifecycle(){return new Y}}class Y extends S{setFunctions(){super.setFunctions(),this.lifecycle.set("getElement",(()=>{})),this.lifecycle.set("updateElement",(()=>{}))}}function T(i){return JSON.parse(JSON.stringify(i))}function D(i,e){const t=i.findIndex((n=>n===e));return t!==-1&&(i.splice(t,1),!0)}class K{constructor(e,t){this.element=e,this.properties=new Map,this.functions=new Map,this.setProperties(t.properties),this.setFunctions(t.functions)}setProperties(e){for(const[t,n]of e)this.properties.set(t,T(n))}setFunctions(e){for(const[t,n]of e)this.functions.set(t,n.bind(this.element,this.element))}set(e,t){this.properties.set(e,t)}get(e){return this.properties.get(e)}fun(e,t){this.functions.set(e,t.bind(this.element,this.element))}call(e,...t){return this.functions.get(e)(...t)}}class q{constructor(e){this.element=e,this.properties=new Map,this.functions=new Map}set(e,t){this.properties.set(e,t)}get(e){return this.properties.get(e)}fun(e,t){this.functions.set(e,t.bind(this.element,this.element))}call(e,...t){return this.functions.get(e)(...t)}}class J{constructor(e){this.events=new Map,this.setEvents(e)}setEvents(e){for(const[t,{check:n,callbacks:s}]of e)this.events.set(t,{check:n,state:new j,callbacks:[...s]})}[Symbol.iterator](){return this.events[Symbol.iterator]()}get(e){return this.events.get(e)}}class j{constructor(){this.keys=new Map}set(e,t){this.keys.set(e,t)}get(e,t){return this.has(e)?this.keys.get(e):t}del(e){this.keys.delete(e)}has(e){return this.keys.has(e)}}class Q{constructor(e){this.events=e}add(e,t){this.events.get(e).callbacks.push(t)}remove(e,t){return D(this.events.get(e).callbacks,t)}removeAll(e){const t=this.events.get(e).callbacks;t.splice(0,t.length)}}class Z{constructor(e){this.layoutParent=e.layoutParent,this.layoutParams=new Map,this.setLayoutParams()}setLayoutParams(){for(const[e,t]of this.layoutParent.childLayoutParams)this.layoutParams.set(e,T(t))}set(e,t){this.layoutParams.has(e)&&this.layoutParams.set(e,t)}get(e){return this.layoutParams.get(e)}}class _{get layoutParams(){return this.layoutParameters}constructor(e,t){this.id=e,this.size={width:0,height:0},this.coords={x:0,y:0},this.properties=new Map,this.functions=new Map,this.lifecycle=new Map,this.setProperties(t.properties),this.setFunctions(t.functions),this.setLifecycle(t.lifecycle),this.inner=new K(this,t.inner),this.custom=new q(this),this.events=new J(t.events),this.listeners=new Q(this.events),this.lifecycle.get("onCreate")()}setProperties(e){for(const[t,n]of e)this.properties.set(t,T(n))}setFunctions(e){for(const[t,n]of e)this.functions.set(t,n.bind(this,this))}setLifecycle(e){for(const[t,n]of e)this.lifecycle.set(t,n.bind(this,this))}set(e,t){this.properties.has(e)&&this.properties.set(e,t)}get(e){return this.properties.get(e)}fun(e,t){this.functions.set(e,t.bind(this,this))}call(e,...t){return this.functions.get(e)(...t)}insertToUI(e){this.removeFromUI(),this.removeFromLayout(),e.element=this,this.uiParent=e}removeFromUI(){this.uiParent&&(this.uiParent.element=null),delete this.uiParent,this.resetPlacementData()}insertToLayout(e){this.removeFromUI(),this.removeFromLayout(),e.children.push(this),this.layoutParent=e,this.layoutParameters=new Z(this)}removeFromLayout(){this.layoutParent&&D(this.layoutParent.children,this),delete this.layoutParent,delete this.layoutParameters,this.resetPlacementData()}resetPlacementData(){this.size={width:0,height:0},this.coords={x:0,y:0}}start(){this.lifecycle.get("onStart")()}measure(e){this.lifecycle.get("onMeasure")(e)}locate(e){this.lifecycle.get("onLocate")(e)}draw(e){this.lifecycle.get("onDraw")(e)}end(){this.lifecycle.get("onEnd")()}signal(e){for(const[,{check:t,state:n,callbacks:s}]of this.events){const{event:o,data:r}=t(this,e,n);if(o)for(const l of s)l(this,r)}}}class ee extends _{constructor(e,t){super(e,t)}measure(e){super.measure(e),this.setSize(e)}setSize(e){this.size=this.lifecycle.get("getSize")(e)}locate(e){super.locate(e),this.setCoords(e)}setCoords(e){this.coords=e}draw(e){super.draw(e),this.drawItself(e)}drawItself(e){this.lifecycle.get("drawItself")(e)}}class I extends _{constructor(e,t){super(e,t),this.children=[],this.childLayoutParams=new Map,this.setChildLayoutParams(t)}setChildLayoutParams(e){for(const[t,n]of e.layoutParams)this.childLayoutParams.set(t,n)}start(){super.start();for(const e of this.children)e.start()}measure(e){super.measure(e),this.setChildrenSizes(e),this.setSize(e)}setChildrenSizes(e){const t=this.sortChildrenToMeasure(e),n=[];for(const s of t){const o=this.getChildMaxSize(e,s,n);s.measure(o),n.push(s)}}sortChildrenToMeasure(e){return this.lifecycle.get("sortChildrenToMeasure")(e)}getChildMaxSize(e,t,n){return this.lifecycle.get("getChildMaxSize")(e,t,n)}setSize(e){this.size=this.lifecycle.get("getSize")(e)}locate(e){super.locate(e),this.setChildrenCoords(e),this.setCoords(e)}setChildrenCoords(e){const t=this.sortChildrenToLocate(e),n=[];for(const s of t){const o=this.getChildCoords(e,s,n);s.locate(o),n.push(s)}}sortChildrenToLocate(e){return this.lifecycle.get("sortChildrenToLocate")(e)}getChildCoords(e,t,n){return this.lifecycle.get("getChildCoords")(e,t,n)}setCoords(e){this.coords=e}draw(e){super.draw(e),this.drawItself(e),this.drawChildren(e)}drawItself(e){this.lifecycle.get("drawItself")(e)}drawChildren(e){const t=this.sortChildrenToDraw(e);for(const n of t)n.draw(e)}sortChildrenToDraw(e){return this.lifecycle.get("sortChildrenToDraw")(e)}end(){super.end();for(const e of this.children)e.end()}signal(e){super.signal(e);for(const t of this.children)t.signal(e)}insert(e){e.insertToLayout(this)}remove(e){this.children.includes(e)&&e.removeFromLayout()}removeAll(){for(const e of[...this.children])e.removeFromLayout()}find(e,t=!1){const n=[...this.children];for(;n.length>0;){const s=n.shift();if(s.id===e)return s;s instanceof I&&!t&&n.push(...s.children)}return null}}class te extends _{constructor(e,t){super(e,t),this.child=this.lifecycle.get("getElement")()}start(){super.start(),this.lifecycle.get("updateElement")(this.child),this.child.start()}measure(e){super.measure(e),this.child.measure(e),this.size=this.child.size}locate(e){super.locate(e),this.child.locate(e),this.coords=e}draw(e){super.draw(e),this.child.draw(e)}end(){super.end(),this.child.end()}signal(e){super.signal(e),this.child.signal(e)}}const b={length(i,e,t=()=>0){let n=i===null?t():i;return n>e&&(n=e),n<0&&(n=0),n},availableLength:(i,e)=>i===null?e:i<e?i:e,desiredLength(i,e){if(i==="auto")return null;const{unit:t,value:n}=i;return t==="px"?n:e*(n/100)},size(i,e,t={width:()=>0,height:()=>0}){return{width:this.length(i.width,e.width,t.width),height:this.length(i.height,e.height,t.height)}},availableSize(i,e){return{width:this.availableLength(i.width,e.width),height:this.availableLength(i.height,e.height)}},desiredSize(i,e){return{width:this.desiredLength(i.width,e.width),height:this.desiredLength(i.height,e.height)}},textSize(i,e){const t=document.createElement("canvas").getContext("2d");return t.font=`${e.weight} ${e.size}px ${e.family}`,{width:t.measureText(i).width,height:e.size}}},P={area(i,e,t,n,s,o){const r={x:e.x+s.size/2,y:e.y+s.size/2},l=t.width-s.size,a=t.height-s.size,c={width:l,height:a};let h=o.size;o.size>l/2&&(h=l/2),o.size>a/2&&(h=a/2),h<0&&(h=0);const f={type:o.type,size:h};i.save(),i.beginPath(),i.fillStyle=n,i.strokeStyle=s.color,i.lineWidth=s.size,this._areaPath(i,r,c,f),i.fill(),s.size>0&&i.stroke(),i.restore()},_areaPath(i,e,t,n){i.moveTo(e.x,e.y+t.height-n.size),this._leftEdgePath(i,e,n),this._topLeftCornerPath(i,e,n),this._topEdgePath(i,e,t,n),this._topRightCornerPath(i,e,t,n),this._rightEdgePath(i,e,t,n),this._bottomRightCornerPath(i,e,t,n),this._bottomEdgePath(i,e,t,n),this._bottomLeftCornerPath(i,e,t,n),i.closePath()},_leftEdgePath(i,e,t){i.lineTo(e.x,e.y+t.size)},_topLeftCornerPath(i,e,t){const n={x:e.x,y:e.y+t.size},s={x:e.x+t.size,y:e.y};t.type==="round"?i.arcTo(n.x,n.y-t.size,s.x,s.y,t.size):i.lineTo(s.x,s.y)},_topEdgePath(i,e,t,n){i.lineTo(e.x+t.width-n.size,e.y)},_topRightCornerPath(i,e,t,n){const s={x:e.x+t.width-n.size,y:e.y},o={x:e.x+t.width,y:e.y+n.size};n.type==="round"?i.arcTo(s.x+n.size,s.y,o.x,o.y,n.size):i.lineTo(o.x,o.y)},_rightEdgePath(i,e,t,n){i.lineTo(e.x+t.width,e.y+t.height-n.size)},_bottomRightCornerPath(i,e,t,n){const s={x:e.x+t.width,y:e.y+t.height-n.size},o={x:e.x+t.width-n.size,y:e.y+t.height};n.type==="round"?i.arcTo(s.x,s.y+n.size,o.x,o.y,n.size):i.lineTo(o.x,o.y)},_bottomEdgePath(i,e,t,n){i.lineTo(e.x+n.size,e.y+t.height)},_bottomLeftCornerPath(i,e,t,n){const s={x:e.x+n.size,y:e.y+t.height},o={x:e.x,y:e.y+t.height-n.size};n.type==="round"?i.arcTo(s.x-n.size,s.y,o.x,o.y,n.size):i.lineTo(o.x,o.y)},rectangle(i,e,t,n){const{x:s,y:o}=e,{width:r,height:l}=t;i.save(),i.fillStyle=n,i.fillRect(s,o,r,l),i.restore()},text(i,e,t,n,s,o,r){i.save(),i.beginPath(),i.rect(e.x,e.y,t.width,t.height),i.clip(),i.font=`${o.weight} ${o.size}px ${o.family}`,i.fillStyle=r,i.textBaseline="top",i.fillText(s,n.x,n.y),i.restore()},image(i,e,t,n){const{x:s,y:o}=e,{width:r,height:l}=t;i.drawImage(n,s,o,r,l)}},g={alignStart:(i,e,t={start:0,end:0})=>i.start+t.start,alignMiddle:(i,e,t={start:0,end:0})=>i.start+(i.end-i.start)/2-(e+t.start+t.end)/2+t.start,alignEnd:(i,e,t={start:0,end:0})=>i.end-e-t.end};function ne(){(function(){const i=m.view.newType("area");i.set("size",{width:{unit:"px",value:100},height:{unit:"px",value:100}}),i.set("background","#000"),i.set("border",{color:"#000",size:0}),i.set("corner",{type:"cut",size:0}),i.lifecycle.set("getSize",(function(e,t){const n=b.desiredSize(e.get("size"),t);return b.size(n,t)})),i.lifecycle.set("drawItself",(function(e,t){const n=e.coords,s=e.size,o=e.get("background"),r=e.get("border"),l=e.get("corner");P.area(t,n,s,o,r,l)}))})(),(function(){const i=m.view.newType("text");i.set("text","Text"),i.set("font",{size:16,family:"Courier New",weight:400}),i.set("color","#000"),i.set("align",{vertical:"middle",horizontal:"left"}),i.lifecycle.set("onMeasure",(function(e){const t=b.textSize(e.get("text"),e.get("font"));e.inner.set("textSize",t)})),i.lifecycle.set("getSize",(function(e,t){return b.size(e.inner.get("textSize"),t)})),i.lifecycle.set("onLocate",(function(e,t){const n=e.inner.call("getTextCoords",t);e.inner.set("textCoords",n)})),i.inner.fun("getTextCoords",(function(e,t){return{x:e.inner.call("getTextX",t),y:e.inner.call("getTextY",t)}})),i.inner.fun("getTextX",(function(e,t){const n=t.x,s={start:n,end:n+e.size.width},o=e.inner.get("textSize").width,r=e.get("align").horizontal;return r==="left"?g.alignStart(s,o):r==="middle"?g.alignMiddle(s,o):g.alignEnd(s,o)})),i.inner.fun("getTextY",(function(e,t){const n=t.y,s={start:n,end:n+e.size.height},o=e.inner.get("textSize").height,r=e.get("align").vertical;return r==="top"?g.alignStart(s,o):r==="middle"?g.alignMiddle(s,o):g.alignEnd(s,o)})),i.lifecycle.set("drawItself",(function(e,t){P.text(t,e.coords,e.size,e.inner.get("textCoords"),e.get("text"),e.get("font"),e.get("color"))}))})(),(function(){const i=m.view.newType("image");i.set("size",{width:100,height:100}),i.set("src",""),i.inner.set("lastSrc",""),i.lifecycle.set("onCreate",(function(e){e.inner.set("img",new Image)})),i.lifecycle.set("onStart",(function(e){e.get("src")!==e.inner.get("lastSrc")&&(e.inner.get("img").src=e.get("src"))})),i.lifecycle.set("getSize",(function(e,t){return b.size(e.get("size"),t)})),i.lifecycle.set("drawItself",(function(e,t){P.image(t,e.coords,e.size,e.inner.get("img"))})),i.lifecycle.set("onEnd",(function(e){e.inner.set("lastSrc",e.get("src"))}))})()}function ie(){const i=m.layout.newType("frame");i.set("size",{width:{unit:"%",value:100},height:{unit:"%",value:100}}),i.set("background","rgba(0,0,0,0)"),i.set("border",{color:"#000",size:0}),i.set("corner",{type:"cut",size:0}),i.layoutParams.set("align",{horizontal:"left",vertical:"top"}),i.layoutParams.set("zIndex",0),i.layoutParams.set("margin",{top:0,right:0,bottom:0,left:0}),(function(e){e.lifecycle.set("onMeasure",(function(t,n){const s=b.desiredSize(t.get("size"),n),o=b.availableSize(s,n),r={width:o.width-2*t.get("border").size,height:o.height-2*t.get("border").size};t.inner.set("desiredSize",s),t.inner.set("availableSize",o),t.inner.set("availableContentSize",r)})),e.lifecycle.set("getChildMaxSize",(function(t,n,s){const o=t.inner.get("availableContentSize"),r=s.layoutParams.get("margin");let l=o.width-r.left-r.right;l<0&&(l=0);let a=o.height-r.top-r.bottom;return a<0&&(a=0),{width:l,height:a}})),e.lifecycle.set("getSize",(function(t,n){const s=b.size(t.inner.get("desiredSize"),n,{width:()=>t.inner.call("getAutoWidth"),height:()=>t.inner.call("getAutoHeight")});return t.inner.set("contentSize",{width:s.width-2*t.get("border").size,height:s.height-2*t.get("border").size}),s})),e.inner.fun("getAutoWidth",(function(t){return t.children.reduce(((n,s)=>{const o=s.layoutParams.get("margin"),r=s.size.width+o.left+o.right;return n>r?n:r}),0)+2*t.get("border").size})),e.inner.fun("getAutoHeight",(function(t){return t.children.reduce(((n,s)=>{const o=s.layoutParams.get("margin"),r=s.size.height+o.top+o.bottom;return n>r?n:r}),0)+2*t.get("border").size}))})(i),(function(e){e.lifecycle.set("onLocate",(function(t,n){t.inner.set("contentCoords",{x:n.x+t.get("border").size,y:n.y+t.get("border").size})})),e.lifecycle.set("getChildCoords",(function(t,n,s){return{x:t.inner.call("getChildX",s),y:t.inner.call("getChildY",s)}})),e.inner.fun("getChildX",(function(t,n){const s=t.inner.get("contentCoords").x,o={start:s,end:s+t.inner.get("contentSize").width},r=n.size.width,l={start:n.layoutParams.get("margin").left,end:n.layoutParams.get("margin").right},a=n.layoutParams.get("align").horizontal;return a==="left"?g.alignStart(o,r,l):a==="middle"?g.alignMiddle(o,r,l):g.alignEnd(o,r,l)})),e.inner.fun("getChildY",(function(t,n){const s=t.inner.get("contentCoords").y,o={start:s,end:s+t.inner.get("contentSize").height},r=n.size.height,l={start:n.layoutParams.get("margin").top,end:n.layoutParams.get("margin").bottom},a=n.layoutParams.get("align").vertical;return a==="top"?g.alignStart(o,r,l):a==="middle"?g.alignMiddle(o,r,l):g.alignEnd(o,r,l)}))})(i),(function(e){e.lifecycle.set("drawItself",(function(t,n){const s=t.coords,o=t.size,r=t.get("background"),l=t.get("border"),a=t.get("corner");P.area(n,s,o,r,l,a)})),e.lifecycle.set("sortChildrenToDraw",(function(t){return[...t.children].sort(((n,s)=>n.layoutParams.get("zIndex")-s.layoutParams.get("zIndex")))}))})(i)}function se(){const i=m.layout.newType("linear");i.set("size",{width:{unit:"%",value:100},height:{unit:"%",value:100}}),i.set("direction","horizontal"),i.set("alignContent","middle"),i.set("alignItems","middle"),i.set("gap",0),i.set("background","rgba(0,0,0,0)"),i.set("border",{color:"#000",size:0}),i.set("corner",{type:"cut",size:0}),i.layoutParams.set("position",0),i.layoutParams.set("alignSelf","auto"),i.layoutParams.set("margin",{top:0,right:0,bottom:0,left:0}),(function(e){e.lifecycle.set("onStart",(function(t){const n=t.get("direction")==="horizontal"||t.get("direction")==="reverse-horizontal",s=t.get("direction")==="reverse-horizontal"||t.get("direction")==="reverse-vertical",o=[...t.children].sort(((r,l)=>r.layoutParams.get("position")-l.layoutParams.get("position")));s&&o.reverse(),t.inner.set("horizontal",n),t.inner.set("reverse",s),t.inner.set("sortedChildren",o)}))})(i),(function(e){e.lifecycle.set("onMeasure",(function(t,n){const s=b.desiredSize(t.get("size"),n),o=b.availableSize(s,n),r={width:o.width-2*t.get("border").size,height:o.height-2*t.get("border").size};t.inner.set("desiredSize",s),t.inner.set("availableSize",o),t.inner.set("availableContentSize",r)})),e.lifecycle.set("sortChildrenToMeasure",(function(t){return t.inner.get("sortedChildren")})),e.lifecycle.set("getChildMaxSize",(function(t,n,s,o){return{width:t.inner.call("getChildMaxWidth",n,s,o),height:t.inner.call("getChildMaxHeight",n,s,o)}})),e.inner.fun("getChildMaxWidth",(function(t,n,s,o){const r=t.inner.get("horizontal"),l=t.inner.get("availableContentSize"),a=t.get("gap"),c=s.layoutParams.get("margin");if(r){const f=o.reduce(((y,z)=>{const p=z.size.width,w=z.layoutParams.get("margin");return y+p+w.left+w.right+a}),0);let d=l.width-f-c.left-c.right;return d<0&&(d=0),d}let h=l.width-c.left-c.right;return h<0&&(h=0),h})),e.inner.fun("getChildMaxHeight",(function(t,n,s,o){const r=t.inner.get("horizontal"),l=t.inner.get("availableContentSize"),a=t.get("gap"),c=s.layoutParams.get("margin");if(!r){const f=o.reduce(((y,z)=>{const p=z.size.height,w=z.layoutParams.get("margin");return y+p+w.top+w.bottom+a}),0);let d=l.height-f-c.top-c.bottom;return d<0&&(d=0),d}let h=l.height-c.top-c.bottom;return h<0&&(h=0),h})),e.lifecycle.set("getSize",(function(t,n){const s=t.inner.call("getChildrenSize"),o=b.size(t.inner.get("desiredSize"),n,{width:()=>s.width+2*t.get("border").size,height:()=>s.height+2*t.get("border").size}),r={width:o.width-2*t.get("border").size,height:o.height-2*t.get("border").size};return t.inner.set("childrenSize",s),t.inner.set("contentSize",r),o})),e.inner.fun("getChildrenSize",(function(t){return{width:t.inner.call("getChildrenWidth"),height:t.inner.call("getChildrenHeight")}})),e.inner.fun("getChildrenWidth",(function(t){if(t.inner.get("horizontal")){const n=t.get("gap");return t.children.reduce(((s,o,r)=>{const l=o.layoutParams.get("margin"),a=o.size.width;return r===0?s+a+l.left+l.right:s+a+l.left+l.right+n}),0)}return t.children.reduce(((n,s)=>{const o=s.layoutParams.get("margin"),r=s.size.width+o.left+o.right;return n>r?n:r}),0)})),e.inner.fun("getChildrenHeight",(function(t){if(!t.inner.get("horizontal")){const n=t.get("gap");return t.children.reduce(((s,o,r)=>{const l=o.layoutParams.get("margin"),a=o.size.height;return r===0?s+a+l.top+l.bottom:s+a+l.top+l.bottom+n}),0)}return t.children.reduce(((n,s)=>{const o=s.layoutParams.get("margin"),r=s.size.height+o.top+o.bottom;return n>r?n:r}),0)}))})(i),(function(e){e.lifecycle.set("onLocate",(function(t,n){const s={x:n.x+t.get("border").size,y:n.y+t.get("border").size},o=t.inner.call("getChildrenCoord",s);t.inner.set("contentCoords",s),t.inner.set("childrenCoord",o)})),e.inner.fun("getChildrenCoord",(function(t,n){const s=t.inner.get("horizontal"),o=t.inner.get("contentSize"),r=t.inner.get("childrenSize"),l=t.get("alignContent");if(s){const h=r.width,f={start:n.x,end:n.x+o.width};return l==="start"?g.alignStart(f,h):l==="middle"?g.alignMiddle(f,h):g.alignEnd(f,h)}const a=r.height,c={start:n.y,end:n.y+o.height};return l==="start"?g.alignStart(c,a):l==="middle"?g.alignMiddle(c,a):g.alignEnd(c,a)})),e.lifecycle.set("sortChildrenToLocate",(function(t){return t.inner.get("sortedChildren")})),e.lifecycle.set("getChildCoords",(function(t,n,s,o){return{x:t.inner.call("getChildX",s,o),y:t.inner.call("getChildY",s,o)}})),e.inner.fun("getChildX",(function(t,n,s){if(t.inner.get("horizontal")){const y=s.length===0,z=n.layoutParams.get("margin");if(y)return t.inner.get("childrenCoord")+z.left;const p=s[s.length-1],w=t.get("gap");return p.coords.x+p.size.width+p.layoutParams.get("margin").right+w+z.left}const o=t.inner.get("contentCoords"),r=t.inner.get("contentSize"),l={start:o.x,end:o.x+r.width},a=n.size.width,c={start:n.layoutParams.get("margin").left,end:n.layoutParams.get("margin").right},h=t.get("alignItems"),f=n.layoutParams.get("alignSelf"),d=f==="auto"?h:f;return d==="start"?g.alignStart(l,a,c):d==="middle"?g.alignMiddle(l,a,c):g.alignEnd(l,a,c)})),e.inner.fun("getChildY",(function(t,n,s){if(!t.inner.get("horizontal")){const y=s.length===0,z=n.layoutParams.get("margin");if(y)return t.inner.get("childrenCoord")+z.top;const p=s[s.length-1],w=t.get("gap");return p.coords.y+p.size.height+p.layoutParams.get("margin").bottom+w+z.top}const o=t.inner.get("contentCoords"),r=t.inner.get("contentSize"),l={start:o.y,end:o.y+r.height},a=n.size.height,c={start:n.layoutParams.get("margin").top,end:n.layoutParams.get("margin").bottom},h=t.get("alignItems"),f=n.layoutParams.get("alignSelf"),d=f==="auto"?h:f;return d==="start"?g.alignStart(l,a,c):d==="middle"?g.alignMiddle(l,a,c):g.alignEnd(l,a,c)}))})(i),(function(e){e.lifecycle.set("drawItself",(function(t,n){const s=t.coords,o=t.size,r=t.get("background"),l=t.get("border"),a=t.get("corner");P.area(n,s,o,r,l,a)}))})(i)}function oe(){const i=m.layout.newType("grid");i.set("size",{width:{unit:"%",value:100},height:{unit:"%",value:100}}),i.set("dimensions",{columns:[{count:1,unit:"fr",value:1}],rows:[{count:1,unit:"fr",value:1}]}),i.set("gap",{size:{vertical:0,horizontal:0},color:"rgba(0,0,0,0)"}),i.set("alignContent",{vertical:"middle",horizontal:"middle"}),i.set("alignItems",{vertical:"middle",horizontal:"middle"}),i.set("background","rgba(0,0,0,0)"),i.set("border",{color:"#000",size:0}),i.set("corner",{type:"cut",size:0}),i.layoutParams.set("position",{column:0,row:0}),i.layoutParams.set("span",{columns:1,rows:1}),i.layoutParams.set("alignSelf",{vertical:"auto",horizontal:"auto"}),i.layoutParams.set("zIndex",0),i.layoutParams.set("margin",{top:0,right:0,bottom:0,left:0}),(function(e){e.inner.fun("areChildCellsValid",(function(t,n){const s=n.layoutParams.get("position"),o=n.layoutParams.get("span"),r=t.inner.get("numColumns"),l=t.inner.get("numRows");return!(s.column<0||s.row<0||o.columns<1||o.rows<1||s.column+o.columns-1>=r||s.row+o.rows-1>=l)}))})(i),(function(e){e.lifecycle.set("onStart",(function(t){const n=t.get("dimensions"),s=n.columns,o=n.rows,r=s.reduce(((a,c)=>a+c.count),0),l=o.reduce(((a,c)=>a+c.count),0);t.inner.set("numColumns",r),t.inner.set("numRows",l)}))})(i),(function(e){e.lifecycle.set("onMeasure",(function(t,n){const s=b.desiredSize(t.get("size"),n);t.inner.set("desiredSize",s);const o=b.availableSize(s,n);t.inner.set("availableSize",o);const r={width:o.width-2*t.get("border").size,height:o.height-2*t.get("border").size};t.inner.set("availableContentSize",r);const l=t.inner.call("getColumnsWidths");t.inner.set("columnsWidths",l);const a=t.inner.call("getRowsHeights");t.inner.set("rowsHeights",a);const c=t.inner.call("getGridSize");t.inner.set("gridSize",c)})),e.inner.fun("getColumnsWidths",(function(t){const n=t.get("dimensions").columns,s=t.inner.get("availableContentSize").width,o=t.get("gap").size.horizontal;return t.inner.call("getPositionsLengths",n,s,o)})),e.inner.fun("getRowsHeights",(function(t){const n=t.get("dimensions").rows,s=t.inner.get("availableContentSize").height,o=t.get("gap").size.vertical;return t.inner.call("getPositionsLengths",n,s,o)})),e.inner.fun("getPositionsLengths",(function(t,n,s,o){const r=n.reduce(((d,y)=>y.count+d),0);if(r===0)return[];let l=s-o*(r-1);l<0&&(l=0);const a=n.reduce(((d,y)=>y.unit==="px"?d+y.count*y.value:d),0),c=(l-(a<l?a:l))/n.reduce(((d,y)=>y.unit==="fr"?d+y.count*y.value:d),0),h=[];let f=l;for(let d=0;d<n.length;d++){const{count:y,unit:z,value:p}=n[d];for(let w=0;w<y;w++){let C;C=z==="px"?p<f?p:f:c*p,h.push(C),f-=C}}return h})),e.inner.fun("getGridSize",(function(t){const n=t.inner.get("numColumns"),s=t.inner.get("numRows"),o=t.inner.get("columnsWidths"),r=t.inner.get("rowsHeights"),l=o.reduce(((c,h)=>c+h),0),a=r.reduce(((c,h)=>c+h),0);return{width:l+t.get("gap").size.horizontal*(n-1),height:a+t.get("gap").size.vertical*(s-1)}})),e.lifecycle.set("getChildMaxSize",(function(t,n,s){const o=t.get("gap").size,r=t.inner.get("columnsWidths"),l=t.inner.get("rowsHeights"),a=s.layoutParams.get("position"),c=s.layoutParams.get("span"),h=s.layoutParams.get("margin");return t.inner.call("areChildCellsValid",s)?{width:r.slice(a.column,a.column+c.columns).reduce(((f,d)=>f+d+o.horizontal),0)-o.horizontal-(h.left+h.right),height:l.slice(a.row,a.row+c.rows).reduce(((f,d)=>f+d+o.vertical),0)-o.vertical-(h.top+h.bottom)}:{width:0,height:0}})),e.lifecycle.set("getSize",(function(t,n){const s=b.size(t.inner.get("desiredSize"),n,{width:()=>t.inner.get("gridSize").width+2*t.get("border").size,height:()=>t.inner.get("gridSize").height+2*t.get("border").size}),o={width:s.width-2*t.get("border").size,height:s.height-2*t.get("border").size};return t.inner.set("contentSize",o),s}))})(i),(function(e){e.lifecycle.set("onLocate",(function(t,n){const s={x:n.x+t.get("border").size,y:n.y+t.get("border").size};t.inner.set("contentCoords",s);const o=t.inner.call("getGridCoords");t.inner.set("gridCoords",o);const r=t.inner.call("getColumnsCoords");t.inner.set("columnsCoords",r);const l=t.inner.call("getRowsCoords");t.inner.set("rowsCoords",l)})),e.inner.fun("getGridCoords",(function(t){return{x:t.inner.call("getGridX"),y:t.inner.call("getGridY")}})),e.inner.fun("getGridX",(function(t){const n=t.inner.get("contentCoords"),s=t.inner.get("contentSize"),o=t.inner.get("gridSize"),r={start:n.x,end:n.x+s.width},l=o.width,a=t.get("alignContent").horizontal;return a==="left"?g.alignStart(r,l):a==="middle"?g.alignMiddle(r,l):g.alignEnd(r,l)})),e.inner.fun("getGridY",(function(t){const n=t.inner.get("contentCoords"),s=t.inner.get("contentSize"),o=t.inner.get("gridSize"),r={start:n.y,end:n.y+s.height},l=o.height,a=t.get("alignContent").vertical;return a==="top"?g.alignStart(r,l):a==="middle"?g.alignMiddle(r,l):g.alignEnd(r,l)})),e.inner.fun("getColumnsCoords",(function(t){const n=t.inner.get("gridCoords").x,s=t.inner.get("columnsWidths"),o=t.get("gap").size.horizontal;return t.inner.call("getPositionsCoords",n,s,o)})),e.inner.fun("getRowsCoords",(function(t){const n=t.inner.get("gridCoords").y,s=t.inner.get("rowsHeights"),o=t.get("gap").size.vertical;return t.inner.call("getPositionsCoords",n,s,o)})),e.inner.fun("getPositionsCoords",(function(t,n,s,o){const r=[];let l=n;for(const a of s)r.push(l),l+=a+o;return r})),e.lifecycle.set("getChildCoords",(function(t,n,s){return t.inner.call("areChildCellsValid",s)?{x:t.inner.call("getChildX",s),y:t.inner.call("getChildY",s)}:{x:0,y:0}})),e.inner.fun("getChildX",(function(t,n){const s=n.layoutParams.get("position").column,o=n.layoutParams.get("span").columns,r=t.get("gap").size.horizontal,l=t.inner.get("columnsCoords"),a=t.inner.get("columnsWidths"),c=l[s],h={start:c,end:c+(a.slice(s,s+o).reduce(((w,C)=>w+C+r),0)-r)},f=n.size.width,d={start:n.layoutParams.get("margin").left,end:n.layoutParams.get("margin").right},y=t.get("alignItems").horizontal,z=n.layoutParams.get("alignSelf").horizontal,p=z==="auto"?y:z;return p==="left"?g.alignStart(h,f,d):p==="middle"?g.alignMiddle(h,f,d):g.alignEnd(h,f,d)})),e.inner.fun("getChildY",(function(t,n){const s=n.layoutParams.get("position").row,o=n.layoutParams.get("span").rows,r=t.get("gap").size.vertical,l=t.inner.get("rowsCoords"),a=t.inner.get("rowsHeights"),c=l[s],h={start:c,end:c+(a.slice(s,s+o).reduce(((w,C)=>w+C+r),0)-r)},f=n.size.height,d={start:n.layoutParams.get("margin").top,end:n.layoutParams.get("margin").bottom},y=t.get("alignItems").vertical,z=n.layoutParams.get("alignSelf").vertical,p=z==="auto"?y:z;return p==="left"?g.alignStart(h,f,d):p==="middle"?g.alignMiddle(h,f,d):g.alignEnd(h,f,d)}))})(i),(function(e){e.lifecycle.set("drawItself",(function(t,n){t.inner.call("drawArea",n),t.inner.call("drawGaps",n)})),e.inner.fun("drawArea",(function(t,n){const s=t.coords,o=t.size,r=t.get("background"),l=t.get("border"),a=t.get("corner");P.area(n,s,o,r,l,a)})),e.inner.fun("drawGaps",(function(t,n){t.inner.call("drawHorizontalGaps",n),t.inner.call("drawVerticalGaps",n)})),e.inner.fun("drawHorizontalGaps",(function(t,n){const s=t.inner.get("gridCoords"),o=t.inner.get("gridSize"),r=t.get("gap").size,l=t.get("gap").color,a=t.inner.get("rowsCoords");for(let c=1;c<a.length;c++){const h={x:s.x,y:a[c]-r.vertical},f={width:o.width,height:r.vertical};P.rectangle(n,h,f,l)}})),e.inner.fun("drawVerticalGaps",(function(t,n){const s=t.inner.get("gridCoords"),o=t.inner.get("gridSize"),r=t.get("gap").size,l=t.get("gap").color,a=t.inner.get("columnsCoords");for(let c=1;c<a.length;c++){const h={x:a[c]-r.horizontal,y:s.y},f={width:r.horizontal,height:o.height};P.rectangle(n,h,f,l)}})),e.lifecycle.set("sortChildrenToDraw",(function(t){return[...t.children].sort(((n,s)=>n.layoutParams.get("zIndex")-s.layoutParams.get("zIndex")))}))})(i)}function re(){const i=m.layout.newType("relative");i.set("size",{width:{unit:"%",value:100},height:{unit:"%",value:100}}),i.set("background","rgba(0,0,0,0)"),i.set("border",{color:"#000",size:0}),i.set("corner",{type:"cut",size:0}),i.layoutParams.set("attachTo",{top:null,right:null,bottom:null,left:null}),i.layoutParams.set("bias",{vertical:50,horizontal:50}),i.layoutParams.set("zIndex",0),i.layoutParams.set("margin",{top:0,right:0,bottom:0,left:0}),(function(e){e.inner.fun("getChildMaxLeft",(function(t,n){const s=n.layoutParams.get("attachTo").left;if(s===null||s==="parent")return t.get("border").size;const{side:o,child:r}=s,l=t.find(r);return o==="left"?t.inner.call("getChildLeft",l):t.inner.call("getChildRight",l)})),e.inner.fun("getChildMaxRight",(function(t,n){const s=n.layoutParams.get("attachTo").right;if(s===null||s==="parent")return t.inner.get("size").width-t.get("border").size;const{side:o,child:r}=s,l=t.find(r);return o==="left"?t.inner.call("getChildLeft",l):t.inner.call("getChildRight",l)})),e.inner.fun("getChildMaxTop",(function(t,n){const s=n.layoutParams.get("attachTo").top;if(s===null||s==="parent")return t.get("border").size;const{side:o,child:r}=s,l=t.find(r);return o==="top"?t.inner.call("getChildTop",l):t.inner.call("getChildBottom",l)})),e.inner.fun("getChildMaxBottom",(function(t,n){const s=n.layoutParams.get("attachTo").bottom;if(s===null||s==="parent")return t.inner.get("size").height-t.get("border").size;const{side:o,child:r}=s,l=t.find(r);return o==="top"?t.inner.call("getChildTop",l):t.inner.call("getChildBottom",l)})),e.inner.fun("getChildLeft",(function(t,n){const s=n.layoutParams.get("attachTo"),o=n.layoutParams.get("margin"),r=t.inner.call("getChildMaxLeft",n),l=t.inner.call("getChildMaxRight",n),a=n.size.width;if(s.right===null)return r+o.left;if(s.left===null)return l-o.right-a;const c={start:r,end:l},h=n.layoutParams.get("bias").horizontal;return t.inner.call("getCoordUsingBias",c,a,h,{start:o.left,end:o.right})})),e.inner.fun("getChildRight",(function(t,n){return t.inner.call("getChildLeft",n)+n.size.width})),e.inner.fun("getChildTop",(function(t,n){const s=n.layoutParams.get("attachTo"),o=n.layoutParams.get("margin"),r=t.inner.call("getChildMaxTop",n),l=t.inner.call("getChildMaxBottom",n),a=n.size.height;if(s.bottom===null)return r+o.top;if(s.top===null)return l-o.bottom-a;const c={start:r,end:l},h=n.layoutParams.get("bias").vertical;return t.inner.call("getCoordUsingBias",c,a,h,{start:o.top,end:o.bottom})})),e.inner.fun("getChildBottom",(function(t,n){return t.inner.call("getChildTop",n)+n.size.height})),e.inner.fun("getCoordUsingBias",(function(t,n,s,o,r){return n.start+(n.end-n.start-(s+r.start+r.end))*(o/100)+r.start}))})(i),(function(e){e.lifecycle.set("onStart",(function(t){const n=t.inner.call("getSortedPositionedChildren"),s=t.children.filter((r=>!n.includes(r))),o=[...n,...s];t.inner.set("sortedChildren",o),t.inner.set("notPositionedChildren",s)})),e.inner.fun("getSortedPositionedChildren",(function(t){const n=[],s=[...t.children];for(;s.length>0;){let o=!1;for(let r=0;r<s.length;r++){const l=s[r];t.inner.call("canPositionChild",n,l)&&(n.push(l),s.splice(r,1),r--,o=!0)}if(!o)break}return n})),e.inner.fun("canPositionChild",(function(t,n,s){const{top:o,bottom:r,right:l,left:a}=s.layoutParams.get("attachTo");for(const c of[o,r,l,a])if(c!==null&&c!=="parent"&&!n.includes(t.find(c.child)))return!1;return!0}))})(i),(function(e){e.lifecycle.set("onMeasure",(function(t,n){const s=b.desiredSize(t.get("size"),n),o=b.availableSize(s,n);t.inner.set("desiredSize",s),t.inner.set("size",o)})),e.lifecycle.set("sortChildrenToMeasure",(function(t){return t.inner.get("sortedChildren")})),e.lifecycle.set("getChildMaxSize",(function(t,n,s){if(t.inner.get("notPositionedChildren").includes(s))return{width:0,height:0};const o=s.layoutParams.get("margin");let r=t.inner.call("getChildMaxRight",s)-t.inner.call("getChildMaxLeft",s)-o.left-o.right;r<0&&(r=0);let l=t.inner.call("getChildMaxBottom",s)-t.inner.call("getChildMaxTop",s)-o.top-o.bottom;return l<0&&(l=0),{width:r,height:l}})),e.lifecycle.set("getSize",(function(t){return t.inner.get("size")}))})(i),(function(e){e.lifecycle.set("sortChildrenToLocate",(function(t){return t.inner.get("sortedChildren")})),e.lifecycle.set("getChildCoords",(function(t,n,s){return t.inner.get("notPositionedChildren").includes(s)?{x:0,y:0}:{x:t.inner.call("getChildLeft",s)+n.x,y:t.inner.call("getChildTop",s)+n.y}}))})(i),(function(e){e.lifecycle.set("drawItself",(function(t,n){const s=t.coords,o=t.size,r=t.get("background"),l=t.get("border"),a=t.get("corner");P.area(n,s,o,r,l,a)})),e.lifecycle.set("sortChildrenToDraw",(function(t){return[...t.children].sort(((n,s)=>n.layoutParams.get("zIndex")-s.layoutParams.get("zIndex")))}))})(i)}function le(){(function(){const i=m.composite.newType("textArea");i.set("size",{width:"auto",height:"auto"}),i.set("background","rgba(0,0,0,0)"),i.set("border",{color:"#000",size:0}),i.set("corner",{type:"cut",size:0}),i.set("text","Text"),i.set("font",{size:16,family:"Courier New",weight:400}),i.set("color","#000"),i.set("align",{vertical:"middle",horizontal:"middle"}),i.set("margin",{top:0,right:0,bottom:0,left:0}),i.lifecycle.set("getElement",(function(){const e=m.layout.new("frame","frame"),t=m.view.new("text","text");return e.insert(t),e})),i.lifecycle.set("updateElement",(function(e,t){t.set("size",e.get("size")),t.set("background",e.get("background")),t.set("border",e.get("border")),t.set("corner",e.get("corner"));const n=t.find("text");n.set("text",e.get("text")),n.set("font",e.get("font")),n.set("color",e.get("color")),n.set("align",e.get("align")),n.layoutParams.set("align",e.get("align")),n.layoutParams.set("margin",e.get("margin"))}))})(),(function(){const i=m.composite.newType("imageArea");i.set("size",{width:"auto",height:"auto"}),i.set("background","rgba(0,0,0,0)"),i.set("border",{color:"#000",size:0}),i.set("corner",{type:"cut",size:0}),i.set("imageSize",{width:100,height:100}),i.set("imageSrc",""),i.set("align",{vertical:"middle",horizontal:"middle"}),i.set("margin",{top:0,right:0,bottom:0,left:0}),i.lifecycle.set("getElement",(function(){const e=m.layout.new("frame","frame"),t=m.view.new("image","image");return e.insert(t),e})),i.lifecycle.set("updateElement",(function(e,t){t.set("size",e.get("size")),t.set("background",e.get("background")),t.set("border",e.get("border")),t.set("corner",e.get("corner"));const n=t.find("image");n.set("size",e.get("imageSize")),n.set("src",e.get("imageSrc")),n.layoutParams.set("align",e.get("align")),n.layoutParams.set("margin",e.get("margin"))}))})()}const A=new Map,B=new Map,R=new Map,m={ui:{new:i=>new U(i)},view:{newType(i){const e=new W(i);return A.set(i,e),e},new(i,e){const t=A.get(e);return new ee(i,t)}},layout:{newType(i){const e=new H(i);return B.set(i,e),e},new(i,e){const t=B.get(e);return new I(i,t)}},composite:{newType(i){const e=new O(i);return R.set(i,e),e},new(i,e){const t=R.get(e);return new te(i,t)}}};ne(),ie(),se(),oe(),re(),le();const ae=function(i){i.inner.fun("getSize",function(e){const t=e.get("block"),n=e.get("gap"),s=e.call("getNumColumns"),o=e.call("getNumRows"),r=t.size*s+n*(s-1),l=t.size*o+n*(o-1);return{width:r,height:l}})},ce=function(i){i.lifecycle.set("getElement",function(e){return m.layout.new("grid","grid")})},ue=function(i){i.lifecycle.set("updateElement",function(e,t){for(const l of[...t.children])t.remove(l);const n=e.inner.call("getSize");t.set("size",{width:{unit:"px",value:n.width},height:{unit:"px",value:n.height}});const s=e.call("getNumColumns"),o=e.call("getNumRows");t.set("dimensions",{columns:[{count:s,unit:"fr",value:1}],rows:[{count:o,unit:"fr",value:1}]});const r=e.get("gap");t.get("gap").size={horizontal:r,vertical:r},e.inner.call("setupBlocks",t)}),i.inner.fun("setupBlocks",function(e,t){const n=e.get("positions");for(const{x:s,y:o}of n){const r=e.inner.call("buildBlock",{x:s,y:o});e.inner.call("insertBlock",t,r,{x:s,y:o})}}),i.inner.fun("buildBlock",function(e,t){const{x:n,y:s}=t,o=m.view.new(`block-${n},${s}`,"area");o.set("size",{width:{unit:"%",value:100},height:{unit:"%",value:100}});const{background:r,border:l,corner:a}=e.get("block");return o.set("background",r),o.set("border",l),o.set("corner",a),o.listeners.add("mousedown",function(c,h){e.signal({type:"blockMouseDown",data:h})}),o}),i.inner.fun("insertBlock",function(e,t,n,s){const{x:o,y:r}=s;t.insert(n),n.layoutParams.set("position",{column:o,row:r})})},he=function(i){ae(i),ce(i),ue(i)},de=function(i){i.fun("getSpan",function(e){return{columns:e.call("getNumColumns"),rows:e.call("getNumRows")}}),i.fun("getNumColumns",function(e){return e.get("positions").reduce((n,s)=>n<s.x?s.x:n,0)+1}),i.fun("getNumRows",function(e){return e.get("positions").reduce((n,s)=>n<s.y?s.y:n,0)+1}),i.fun("rotate",function(e){const t=e.get("positions"),n=e.call("getNumColumns")-1,s=[];for(const{x:o,y:r}of t)s.push({x:r,y:n-o});e.set("positions",s)})},ge=function(i){i.events.set("blockMouseDown",function(e,t,n){return t.type!=="blockMouseDown"?{event:!1}:{event:!0,data:t.data}})},fe=function(){const i=m.composite.newType("piece");i.set("positions",[{x:0,y:0}]),i.set("block",{size:35,background:"#000",border:{color:"#000",size:0},corner:{type:"cut",size:0}}),i.set("gap",0),he(i),de(i),ge(i)},me=function(i){i.inner.fun("getSize",function(e){const t=e.get("dimensions"),n=e.get("block"),s=e.get("gap"),o=e.get("border"),r=t.columns*n.size+s.size*(t.columns-1)+o.size*2,l=t.rows*n.size+s.size*(t.rows-1)+o.size*2;return{width:r,height:l}})},ye=function(i){i.lifecycle.set("getElement",function(e){return m.layout.new("grid","grid")})},pe=function(i){i.lifecycle.set("updateElement",function(e,t){t.removeAll();const n=e.inner.call("getSize");t.set("size",{width:{unit:"px",value:n.width},height:{unit:"px",value:n.height}});const s=e.get("dimensions");t.set("dimensions",{columns:[{count:s.columns,unit:"fr",value:1}],rows:[{count:s.rows,unit:"fr",value:1}]});const o=e.get("gap");t.set("gap",{size:{horizontal:o.size,vertical:o.size},color:o.color});const r=e.get("background");t.set("background",r);const l=e.get("border");t.set("border",l);const a=e.get("corner");t.set("corner",a),e.inner.call("setupPieceElements",t)}),i.inner.fun("setupPieceElements",function(e,t){const n=e.inner.get("pieces");for(const s of n){const o=e.inner.call("buildPieceElement",s.piece);e.inner.call("insertPieceElement",t,o,s.position)}}),i.inner.fun("buildPieceElement",function(e,t){const n=m.composite.new(`piece-${t.id}`,"piece"),s=e.get("block"),o=e.get("gap");return n.set("positions",t.positions),n.set("block",{size:s.size,background:t.background,border:{size:s.border,color:t.border},corner:{type:"round",size:s.corner}}),n.set("gap",o.size),n.listeners.add("blockMouseDown",(r,l)=>{e.signal({type:"pieceMouseDown",data:{piece:t,coords:r.coords,mouse:l}})}),n}),i.inner.fun("insertPieceElement",function(e,t,n,s){const{x:o,y:r}=s,l=n.call("getNumColumns"),a=n.call("getNumRows");t.insert(n),n.layoutParams.set("position",{column:o,row:r}),n.layoutParams.set("span",{columns:l,rows:a})})},ze=function(i){me(i),ye(i),pe(i)},we=function(i){i.fun("insert",function(e,t,n){e.inner.get("pieces").push({position:t,piece:n})}),i.fun("remove",function(e,t){const n=e.inner.get("pieces").filter(({position:s})=>s.x!==t.x||s.y!==t.y);e.inner.set("pieces",n)}),i.fun("getAll",function(e){return e.inner.get("pieces")}),i.fun("removeAll",function(e){e.inner.set("pieces",[])}),i.fun("areCoordsInside",function(e,t){function n(r,l,a){return r.x>=l.x&&r.y>=l.y&&r.x<=l.x+a.width&&r.y<=l.y+a.height}const s=e.call("getContentCoords"),o=e.call("getContentSize");return n(t,s,o)}),i.fun("getPositionFromCoords",function(e,t){const n=e.call("getContentCoords"),s=e.call("getContentSize"),o=e.get("dimensions"),r={width:s.width/o.columns,height:s.height/o.rows},l={x:t.x-n.x,y:t.y-n.y};return{x:Math.floor(l.x/r.width),y:Math.floor(l.y/r.height)}}),i.fun("getContentCoords",function(e){const t=e.get("border").size;return{x:e.coords.x+t,y:e.coords.y+t}}),i.fun("getContentSize",function(e){const t=e.get("border").size;return{width:e.size.width-t*2,height:e.size.height-t*2}})},be=function(i){i.events.set("pieceMouseDown",function(e,t,n){return t.type!=="pieceMouseDown"?{event:!1}:{event:!0,data:t.data}})},Pe=function(){const i=m.composite.newType("puzzle");i.set("dimensions",{columns:10,rows:10}),i.set("block",{size:35,border:0,corner:0}),i.set("gap",{size:1,color:"#fff"}),i.set("background","#f0f0f0"),i.set("border",{color:"#000",size:0}),i.set("corner",{type:"cut",size:0}),i.inner.set("pieces",[]),ze(i),we(i),be(i)},Ce=function(){fe(),Pe()};class xe{constructor(e,t){this.view=e,this.model=t,this._bind(),this.model.start()}_bind(){this._bindPlay(),this._bindRotatePiece(),this._bindSelectFromPieces(),this._bindSelectFromPuzzle(),this._bindMovePiece(),this._bindDropPiecePuzzle(),this._bindDropPiece(),this._bindUpdate()}_bindPlay(){this.view.handlerPlay(()=>this.model.start())}_bindRotatePiece(){this.view.handlerRotatePiece(e=>this.model.rotatePiece(e))}_bindSelectFromPieces(){this.view.handlerSelectFromPieces((e,t,n)=>this.model.selectFromPieces(e,t,n))}_bindSelectFromPuzzle(){this.view.handlerSelectFromPuzzle((e,t,n)=>this.model.selectFromPuzzle(e,t,n))}_bindMovePiece(){this.view.handlerMovePiece(e=>this.model.moveSelectedPiece(e))}_bindDropPiecePuzzle(){this.view.handlerDropPieceInPuzzle(e=>{this.model.insertSelectedToPuzzle(e)||this.model.insertSelectedToPieces()})}_bindDropPiece(){this.view.handlerDropPiece(()=>this.model.insertSelectedToPieces())}_bindUpdate(){this.model.handlerUpdate(()=>this.view.update(this.model))}}const u={dimensions:{columns:5,rows:5},numPieces:4,styles:{area:{background:"#F5F5F5",border:{size:5,color:"#E0E0E0"},corner:{type:"round",size:10}},block:{size:25,border:5,corner:5,gap:0},button:{color:"#626262",background:"#F5F5F5",border:{size:5,color:"#E0E0E0"},corner:{type:"round",size:10},font:{family:"Raleway, sans-serif",size:16,weight:600},mousedown:{background:"#E0E0E0"}}}};function ve(i,e,t){const n=Se(i,e,t);return Ie(n,t)}function Se(i,e,t){const n=ke(i,e);for(;k(n,0);)Me(n,t),!k(n,0)&&!Te(n,t)&&_e(n,0);return n}function ke(i,e){const t=[];for(let n=0;n<i;n++){t.push([]);for(let s=0;s<e;s++)t[n].push(0)}return t}function k(i,e){for(const t of i)if(t.includes(e))return!0;return!1}function Me(i,e){let t=!1;const n=L(i,0);for(;!t;){const s=F(1,e),o=Ae(n);Ee(i,e,s,o)&&(i[o.y][o.x]=s,t=!0)}}function L(i,e){const t=[];for(let n=0;n<i.length;n++)for(let s=0;s<i[n].length;s++)i[n][s]===e&&t.push({x:s,y:n});return t}function Ee(i,e,t,n){return i[n.y][n.x]!==0?!1:L(i,t).length===0||n.x>0&&i[n.y][n.x-1]===t||n.y>0&&i[n.y-1][n.x]===t||n.x<i[0].length-1&&i[n.y][n.x+1]===t||n.y<i.length-1&&i[n.y+1][n.x]===t}function Te(i,e){if(k(i,0))return!1;let n=i.length*i[0].length/e;n%2!==0&&(n+=1);const s=n-n/2,o=n+n/2;for(let r=0;r<e;r++){const l=L(i,r+1).length;if(l<s||l>o)return!1}return!0}function _e(i,e){for(let t=0;t<i.length;t++)for(let n=0;n<i[t].length;n++)i[t][n]=e}function Ie(i,e){const t=[];for(let n=0;n<e;n++){const s=Le(i,n+1),o=Fe(s,F(0,3));t.push(o)}return t}function Le(i,e){const t=[],n={x:null,y:null},s=[];for(let o=0;o<i.length;o++)for(let r=0;r<i[o].length;r++)i[o][r]===e&&((n.y===null||o<n.y)&&(n.y=o),(n.x===null||r<n.x)&&(n.x=r),s.push({x:r,y:o}));for(const{x:o,y:r}of s)t.push({x:o-n.x,y:r-n.y});return t}function Fe(i,e){let t=[...i];for(let n=0;n<e;n++){const s=[],o=t.reduce((r,l)=>r<l.x?l.x:r,0);for(const{x:r,y:l}of t)s.push({x:l,y:o-r});t=s}return t}function Ae(i){return i[F(0,i.length-1)]}function F(i,e){return Math.floor(Math.random()*(e-i+1)+i)}function Be(i){const e=[],t=Re();for(let n=0;n<i;n++){const s=Math.floor(Math.random()*t.length);e.push(t.splice(s,1)[0])}return e}function Re(){return[{background:"#f94144",border:"#e03b3d"},{background:"#f3722c",border:"#db6728"},{background:"#f8961e",border:"#df871b"},{background:"#f9844a",border:"#e07743"},{background:"#f9c74f",border:"#e0b347"},{background:"#90be6d",border:"#82ab62"},{background:"#43aa8b",border:"#3c997d"},{background:"#4d908e",border:"#458280"},{background:"#577590",border:"#4e6982"},{background:"#277da1",border:"#237191"}]}class M{constructor(e,t,n,s){this.id=e,this.positions=t,this.background=n,this.border=s}get span(){return{columns:this.numColumns,rows:this.numRows}}get numColumns(){return this.positions.reduce((e,t)=>e<t.x?t.x:e,0)+1}get numRows(){return this.positions.reduce((e,t)=>e<t.y?t.y:e,0)+1}rotate(){const e=this.positions,t=this.numColumns-1,n=[];for(const{x:s,y:o}of e)n.push({x:o,y:t-s});this.positions=n}convertToSelectedPieceModel(e,t){return new De(this.id,this.positions,this.background,this.border,e,t)}}class De extends M{constructor(e,t,n,s,o,r){super(e,t,n,s),this.coords=o,this.offset=r}convertToPieceModel(){return new M(this.id,this.positions,this.background,this.border)}}function Ue(i,e,t){const n=[],s=ve(i,e,t),o=Be(t);for(let r=0;r<t;r++){const l=s[r],a=o[r],c=new M(r,l,a.background,a.border);n.push(c)}return n}class Ne{constructor(){this.pieces=[]}insert(e){this.pieces.splice(e.id,0,e)}get(e){return this.pieces.find(t=>t.id===e)}remove(e){const t=this.pieces.findIndex(n=>n.id===e);return t===-1?!1:(this.pieces.splice(t,1),!0)}rotate(e){const t=this.pieces.find(n=>n.id===e);return t===null?!1:(t.rotate(),!0)}getAll(){return[...this.pieces]}removeAll(){this.pieces=[]}generate(){const e=Ue(u.dimensions.rows,u.dimensions.columns,u.numPieces);for(const t of e)this.insert(t)}}class Ve{constructor(){this.positionedPieces=[]}insert(e,t){return this._canInsert(e,t)?(this.positionedPieces.push({position:e,piece:t}),!0):!1}get(e){return this.positionedPieces.find(({piece:t})=>t.id===e)}remove(e){const t=this.positionedPieces.findIndex(({piece:n})=>n.id===e);return t===-1?!1:(this.positionedPieces.splice(t,1),!0)}getFromPosition(e){for(const t of this.positionedPieces)if(this._inPiece(e,t))return t;return null}removeFromPosition(e){const t=this.positionedPieces.findIndex(({position:n})=>n.x!==e.x||n.y!==e.y);return t===-1?!1:(this.positionedPieces.splice(t,1),!0)}getAll(){return[...this.positionedPieces]}removeAll(){this.positionedPieces=[]}_canInsert(e,t){return!(!this._inArea(e,t)||this._overlappingWithPieces(e,t))}_inArea(e,t){return!(e.x<0||e.y<0||e.x+t.numColumns>u.dimensions.columns||e.y+t.numRows>u.dimensions.rows)}_overlappingWithPieces(e,t){for(const n of this.positionedPieces)if(this._overlappingWithPiece(e,t,n))return!0;return!1}_overlappingWithPiece(e,t,n){const s=t.positions.map(r=>({x:e.x+r.x,y:e.y+r.y})),o=n.piece.positions.map(r=>({x:n.position.x+r.x,y:n.position.y+r.y}));for(const r of s)for(const l of o)if(r.x===l.x&&r.y===l.y)return!0;return!1}_inPiece(e,t){for(const n of t.piece.positions)if(e.x===n.x+t.position.x&&e.y===n.y+t.position.y)return!0;return!1}}class We{constructor(){this.puzzle=new Ve,this.pieces=new Ne,this.selectedPiece=null}start(){this.puzzle.removeAll(),this.pieces.removeAll(),this.pieces.generate(),this.onUpdate(this)}selectFromPieces(e,t,n){const s=this.pieces.get(e);this.pieces.remove(e),this.selectedPiece=s.convertToSelectedPieceModel(t,n),this.onUpdate(this)}selectFromPuzzle(e,t,n){const{piece:s}=this.puzzle.get(e);this.puzzle.remove(e),this.selectedPiece=s.convertToSelectedPieceModel(t,n),this.onUpdate(this)}insertSelectedToPieces(){const e=this.selectedPiece.convertToPieceModel();this.pieces.insert(e),this.selectedPiece=null,this.onUpdate(this)}insertSelectedToPuzzle(e){const t=this.selectedPiece.convertToPieceModel();return this.puzzle.insert(e,t)?(this.selectedPiece=null,this.onUpdate(this),!0):!1}moveSelectedPiece(e){this.selectedPiece.coords=e,this.onUpdate(this)}rotatePiece(e){this.pieces.rotate(e),this.onUpdate(this)}handlerUpdate(e){this.onUpdate=e}}class Ge{id="pieces";pieceContainerId="pieceContainer";pieceAreaId="pieceArea";rotateButtonId="rotateButton";pieceId="piece";constructor(){this.piecesElement=this._build()}_build(){const e=m.layout.new(this.id,"linear");e.set("size",{width:"auto",height:"auto"}),e.set("direction","horizontal"),e.set("gap",20);for(let t=0;t<u.numPieces;t++){const n=this._buildPieceContainer(t);this._insertPieceContainer(e,n)}return e}_buildPieceContainer(e){const t=this.pieceContainerId+e,n=m.layout.new(t,"linear");n.set("size",{width:"auto",height:"auto"}),n.set("direction","vertical"),n.set("gap",15);const s=this._buildPieceArea(e);this._insertPieceArea(n,s);const o=this._buildRotateButton(e);return this._insertRotateButton(n,o),n}_buildPieceArea(e){const t=this.pieceAreaId+e,n=m.layout.new(t,"frame"),s=u.dimensions.columns*u.styles.block.size+u.styles.area.border.size*2+u.styles.block.gap*(u.dimensions.columns-1),o=u.dimensions.rows*u.styles.block.size+u.styles.area.border.size*2+u.styles.block.gap*(u.dimensions.rows-1);return n.set("size",{width:{unit:"px",value:s},height:{unit:"px",value:o}}),n.set("background",u.styles.area.background),n.set("border",u.styles.area.border),n.set("corner",u.styles.area.corner),n}_insertPieceArea(e,t){e.insert(t),t.layoutParams.set("position",{column:0,row:0})}_buildRotateButton(e){const t=this.rotateButtonId+e,n=m.composite.new(t,"imageArea"),s=u.dimensions.columns*u.styles.block.size+u.styles.area.border.size*2;return n.set("size",{width:{unit:"px",value:s},height:{unit:"px",value:40}}),n.set("imageSrc","rotate.svg"),n.set("imageSize",{width:20,height:20}),n.set("color",u.styles.button.color),n.set("background",u.styles.button.background),n.set("border",u.styles.button.border),n.set("corner",u.styles.button.corner),n}_insertRotateButton(e,t){e.insert(t),t.layoutParams.set("position",{column:0,row:1})}_insertPieceContainer(e,t,n){e.insert(t),t.layoutParams.set("position",n)}insert(e){const t=this.piecesElement.find(this.pieceAreaId+e.id),n=this._buildPiece(e);this._insertPiece(t,n),this._setPieceMouseDownListener(n,e)}_buildPiece(e){const t=m.composite.new(this.pieceId+e.id,"piece");return t.set("positions",e.positions),t.set("block",{size:u.styles.block.size,background:e.background,border:{size:u.styles.block.border,color:e.border},corner:{type:"round",size:u.styles.block.corner}}),t.set("gap",u.styles.block.gap),t}_insertPiece(e,t){e.insert(t),t.layoutParams.set("align",{horizontal:"middle",vertical:"middle"})}_setPieceMouseDownListener(e,t){e.listeners.add("blockMouseDown",(n,s)=>{const o={x:s.x-n.coords.x,y:s.y-n.coords.y};this.onPieceMouseDown(t.id,s,o)})}has(e){return this.piecesElement.find(this.pieceId+e)!==null}removeAll(){for(let e=0;e<u.numPieces;e++){const t=this.piecesElement.find(this.pieceAreaId+e);this.piecesElement.find(this.pieceId+e)?.listeners.removeAll("blockMouseDown"),t.removeAll()}}handlerRotateClick(e){for(let t=0;t<u.numPieces;t++)this.piecesElement.find(this.rotateButtonId+t).listeners.add("click",function(s){e(t)})}handlerPieceMouseDown(e){this.onPieceMouseDown=e}}class He{id="playButton";constructor(){this.playButtonElement=this._build()}_build(){const e=m.composite.new(this.id,"textArea");return e.set("size",{width:{unit:"px",value:150},height:{unit:"px",value:45}}),e.set("text","Play"),e.set("color",u.styles.button.color),e.set("background",u.styles.button.background),e.set("border",u.styles.button.border),e.set("corner",u.styles.button.corner),e.set("font",u.styles.button.font),e}handlerClick(e){this.playButtonElement.listeners.add("click",function(t){e()})}}class $e{id="puzzle";constructor(){this.puzzleElement=this._build()}_build(){const e=m.composite.new(this.id,"puzzle");return e.set("dimensions",u.dimensions),e.set("block",{size:u.styles.block.size,border:u.styles.block.border,corner:u.styles.block.corner}),e.set("gap",{size:u.styles.block.gap,color:"rgba(0,0,0,0)"}),e.set("background",u.styles.area.background),e.set("border",u.styles.area.border),e.set("corner",u.styles.area.corner),e}insert(e,t){this.puzzleElement.call("insert",e,t)}removeAll(){this.puzzleElement.call("removeAll")}handlerPieceMouseDown(e){this.puzzleElement.listeners.add("pieceMouseDown",function(t,n){const{piece:s,coords:o,mouse:r}=n,l={x:r.x-o.x,y:r.y-o.y};e(s.id,r,l)})}areCoordsInside(e){return this.puzzleElement.call("areCoordsInside",e)}getPositionFromCoords(e){return this.puzzleElement.call("getPositionFromCoords",e)}}class Xe{id="root";selectedPieceId="selectedPiece";constructor(){this.rootElement=this._build(),this.puzzle=new $e,this._insertPuzzle(),this.pieces=new Ge,this._insertPieces(),this.playButton=new He,this._insertPlayButton(),this._setupEffects()}_build(){return m.layout.new(this.id,"relative")}_insertPuzzle(){const e=this.puzzle.puzzleElement;this.rootElement.insert(e),e.layoutParams.set("attachTo",{top:"parent",left:"parent",right:"parent",bottom:"parent"}),e.layoutParams.get("bias").vertical=45}_insertPieces(){const e=this.pieces.piecesElement;this.rootElement.insert(e),e.layoutParams.get("attachTo").top={side:"bottom",child:this.puzzle.id},e.layoutParams.get("attachTo").left="parent",e.layoutParams.get("attachTo").right="parent",e.layoutParams.get("margin").top=50}_insertPlayButton(){const e=this.playButton.playButtonElement;this.rootElement.insert(e),e.layoutParams.get("attachTo").top={side:"top",child:this.puzzle.id},e.layoutParams.get("attachTo").bottom={side:"bottom",child:this.puzzle.id},e.layoutParams.get("attachTo").right={side:"left",child:this.puzzle.id},e.layoutParams.get("margin").right=30}_setupEffects(){this._setupRotateButtonEffects(),this._setupPlayButtonEffects()}_setupRotateButtonEffects(){for(let e=0;e<u.numPieces;e++){const t=this.pieces.piecesElement,n=this.pieces.rotateButtonId+e,s=t.find(n);s.listeners.add("mousedown",function(){s.set("background",u.styles.button.mousedown.background)}),this.rootElement.listeners.add("mouseup",function(){s.set("background",u.styles.button.background)})}}_setupPlayButtonEffects(){const e=this.playButton.playButtonElement;e.listeners.add("mousedown",function(){e.set("background",u.styles.button.mousedown.background)}),this.rootElement.listeners.add("mouseup",function(){e.set("background",u.styles.button.background)})}insertSelectedPiece(e){const t=this._buildSelectedPiece(e);this.rootElement.insert(t);const n={x:e.coords.x-e.offset.x,y:e.coords.y-e.offset.y};t.layoutParams.get("margin").left=n.x,t.layoutParams.get("margin").top=n.y}_buildSelectedPiece(e){const t=m.composite.new(this.selectedPieceId,"piece");return t.set("positions",e.positions),t.set("block",{size:u.styles.block.size,background:e.background,border:{size:u.styles.block.border,color:e.border},corner:{type:"round",size:u.styles.block.corner}}),t.set("gap",u.styles.block.gap),t}removeSelectedPiece(){const e=this.rootElement.find(this.selectedPieceId);this.rootElement.remove(e)}handlerMouseMove(e){this.rootElement.listeners.add("mousemove",function(t,n){e(n)})}handlerMouseUp(e){this.rootElement.listeners.add("mouseup",function(t,n){e(n)})}hasSelectedPiece(){return this.rootElement.find(this.selectedPieceId)!==null}getSelectedPieceCoords(){const e=this.rootElement.find(this.selectedPieceId),t=e.layoutParams.get("margin"),n={width:e.size.width/e.call("getNumColumns"),height:e.size.height/e.call("getNumRows")},s={x:n.width/2,y:n.height/2};return{x:t.left+s.x,y:t.top+s.y}}}class Oe{constructor(){this.ui=m.ui.new("#ui"),this.root=new Xe,this.ui.start(this.root.rootElement)}handlerPlay(e){this.root.playButton.handlerClick(function(){e()})}handlerRotatePiece(e){this.root.pieces.handlerRotateClick((function(t){this.root.pieces.has(t)&&e(t)}).bind(this))}handlerSelectFromPieces(e){this.root.pieces.handlerPieceMouseDown(function(t,n,s){e(t,n,s)})}handlerSelectFromPuzzle(e){this.root.puzzle.handlerPieceMouseDown(function(t,n,s){e(t,n,s)})}handlerMovePiece(e){this.root.handlerMouseMove((function(t){this.root.hasSelectedPiece()&&e(t)}).bind(this))}handlerDropPieceInPuzzle(e){this.root.handlerMouseUp((function(){if(!this.root.hasSelectedPiece())return;const t=this.root.getSelectedPieceCoords();if(!this.root.puzzle.areCoordsInside(t))return;const n=this.root.puzzle.getPositionFromCoords(t);e(n)}).bind(this))}handlerDropPiece(e){this.root.handlerMouseUp((function(){if(!this.root.hasSelectedPiece())return;const t=this.root.getSelectedPieceCoords();this.root.puzzle.areCoordsInside(t)||e()}).bind(this))}update(e){this._updatePuzzle(e.puzzle),this._updatePieces(e.pieces),this._updateSelectedPiece(e.selectedPiece)}_updatePuzzle(e){this.root.puzzle.removeAll();const t=e.getAll();for(const{position:n,piece:s}of t)this.root.puzzle.insert(n,s)}_updatePieces(e){this.root.pieces.removeAll();const t=e.getAll();for(const n of t)this.root.pieces.insert(n)}_updateSelectedPiece(e){this.root.removeSelectedPiece(),e&&this.root.insertSelectedPiece(e)}}Ce();const Ye=new Oe,Ke=new We;new xe(Ye,Ke);
